/*!
 * Ico
 * Copyright (C) 2009-2011 Alex R. Young
 * MIT Licensed
 */
(function(d){var b={VERSION:"0.3.1",round:function(f,g){var e=Math.round(f*Math.pow(10,g))/Math.pow(10,g);return e}};function c(e){return e>1?e-1:1}function a(g,e){if(typeof window==="undefined"){return}var f;if(g.currentStyle){f=g.currentStyle[e]}else{if(window.getComputedStyle){f=document.defaultView.getComputedStyle(g,null).getPropertyValue(e)}}if(f&&f.length===0){f=null}return f}Array.prototype.sum=function(){for(var e=0,f=0;e<this.length;f+=this[e++]){}return f};if(typeof Array.prototype.max==="undefined"){Array.prototype.max=function(){return Math.max.apply({},this)}}if(typeof Array.prototype.min==="undefined"){Array.prototype.min=function(){return Math.min.apply({},this)}}Array.prototype.mean=function(){return this.sum()/this.length};Array.prototype.variance=function(){var e=this.mean(),f=0;for(var g=0;g<this.length;g++){f+=Math.pow(this[g]-e,2)}return f/(this.length-1)};Array.prototype.standard_deviation=function(){return Math.sqrt(this.variance())};if(typeof Object.extend==="undefined"){Object.extend=function(e,g){for(var f in g){if(g.hasOwnProperty(f)){e[f]=g[f]}}return e}}b.Normaliser=function(f,e){this.options={start_value:null};if(typeof e!=="undefined"){this.options=e}this.min=f.min();this.max=f.max();this.standard_deviation=f.standard_deviation();this.range=0;this.step=this.labelStep(this.max-this.min);this.start_value=this.calculateStart();this.process()};b.Normaliser.prototype={calculateStart:function(){var e=typeof this.options.start_value!=="undefined"&&this.min>=0?this.options.start_value:this.min,f=this.round(e,1);if(this.min>0&&f>this.min){return 0}if(this.min===this.max){return 0}return f},round:function(e,g){g=g||1;var f=e;if(this.standard_deviation>0.1){var h=Math.pow(10,-g);f=Math.round(e*h)/h;if(f>this.min){return this.round(e-this.step)}}return f},process:function(){this.range=this.max-this.start_value;this.step=this.labelStep(this.range)},labelStep:function(e){return Math.pow(10,Math.round((Math.log(e)/Math.LN10))-1)}};
/*!
 * Ico
 * Copyright (C) 2009-2011 Alex R. Young
 * MIT Licensed
 */
b.Base={normaliseData:function(g){var e=[],f=0;for(f=0;f<g.length;f++){e.push(this.normalise(g[f]))}return e},flatten:function(h){var e=[];if(typeof h.length==="undefined"){if(typeof h==="object"){for(var g in h){if(h.hasOwnProperty(g)){e=e.concat(this.flatten(h[g]))}}}else{return[]}}for(var f=0;f<h.length;f++){if(typeof h[f].length==="number"){e=e.concat(this.flatten(h[f]))}else{e.push(h[f])}}return e},makeRange:function(h,e){var f=[],g;for(g=h;g<e;g++){f.push(g)}return f}};b.BaseGraph=function(){this.initialize.apply(this,arguments)};Object.extend(b.BaseGraph.prototype,b.Base);Object.extend(b.BaseGraph.prototype,{initialize:function(g,h,e){this.element=g;this.data_sets=this.buildDataSets(h,e);this.flat_data=this.flatten(h);this.data_size=this.longestDataSetLength();if(e&&e.colour){e.colours={};for(var f in this.data_sets){if(this.data_sets.hasOwnProperty(f)){e.colours[f]=e.colour}}}this.options={width:parseInt(a(g,"width"),10),height:parseInt(a(g,"height"),10),labels:this.makeRange(1,this.data_size+1),plot_padding:10,font_size:10,show_horizontal_labels:true,show_vertical_labels:true,background_colour:a(g,"backgroundColor")||"#ffffff",label_colour:"#666",markers:false,marker_size:5,meanline:false,grid:false,grid_colour:"#ccc",y_padding_top:20,draw:true};Object.extend(this.options,this.chartDefaults()||{});Object.extend(this.options,e||{});this.normaliser=new b.Normaliser(this.flat_data,this.normaliserOptions());this.label_step=this.normaliser.step;this.range=this.normaliser.range;this.start_value=this.normaliser.start_value;this.x_padding_left=10+this.paddingLeftOffset();this.x_padding_right=20;this.x_padding=this.x_padding_left+this.x_padding_right;this.y_padding_top=this.options.y_padding_top;this.y_padding_bottom=20+this.paddingBottomOffset();this.y_padding=this.y_padding_top+this.y_padding_bottom;this.graph_width=this.options.width-(this.x_padding);this.graph_height=this.options.height-(this.y_padding);this.step=this.calculateStep();this.y_label_count=Math.ceil(this.range/this.label_step);if((this.normaliser.min+(this.y_label_count*this.normaliser.step))<this.normaliser.max){this.y_label_count+=1}this.value_labels=this.makeValueLabels(this.y_label_count);this.top_value=this.value_labels[this.value_labels.length-1];this.grid_start_offset=-1;if(this.options.draw){if(typeof this.options.colours==="undefined"){this.options.colours=this.makeRandomColours()}this.paper=Raphael(this.element,this.options.width,this.options.height);this.background=this.paper.rect(0,0,this.options.width,this.options.height);this.background.attr({fill:this.options.background_colour,stroke:"none"});if(this.options.meanline===true){this.options.meanline={"stroke-width":"2px",stroke:"#BBBBBB"}}this.setChartSpecificOptions();this.lastPoint={x:0,y:0};this.draw()}},buildDataSets:function(f,e){return(typeof f.length!=="undefined")?{one:f}:f},normaliserOptions:function(){return{}},chartDefaults:function(){return{}},drawPlot:function(g,f,e,i,h){},calculateStep:function(){},makeRandomColours:function(){var f={};for(var e in this.data_sets){if(!f.hasOwnProperty(e)){f[e]=Raphael.hsb2rgb(Math.random(),1,0.75).hex}}return f},longestDataSetLength:function(){var f=0;for(var e in this.data_sets){if(this.data_sets.hasOwnProperty(e)){f=this.data_sets[e].length>f?this.data_sets[e].length:f}}return f},roundValue:function(f,e){var g=Math.pow(10,e);f*=g;f=Math.round(f)/g;return f},roundValues:function(h,g){var e=[];for(var f=0;f<h.length;f++){e.push(this.roundValue(h[f],g))}return e},longestLabel:function(e){var f=Array.prototype.slice.call(e||this.options.labels,0);if(f.length){return f.sort(function(h,g){return h.toString().length<g.toString().length})[0].toString().length}return 0},paddingLeftOffset:function(){var f=this.roundValues(this.flat_data,2),e=0;e=f.sort(function(h,g){return h.toString().length<g.toString().length})[0].toString().length;e=e>2?e-1:e;return 10+(e*this.options.font_size)},paddingBottomOffset:function(){return this.options.font_size},normalise:function(f){var e=this.start_value===0?this.top_value:this.range;return((f/e)*(this.graph_height))},draw:function(){if(this.options.grid){this.drawGrid()}if(this.options.meanline){this.drawMeanLine(this.normaliseData(this.flat_data))}this.drawAxis();if(this.options.show_vertical_labels){this.drawVerticalLabels()}if(this.options.show_horizontal_labels){this.drawHorizontalLabels()}for(var e in this.data_sets){if(this.data_sets.hasOwnProperty(e)){var f=this.data_sets[e];this.drawLines(e,this.options.colours[e],this.normaliseData(f))}}if(this.start_value!==0){this.drawFocusHint()}},drawGrid:function(){var f="",h;if(this.options.show_vertical_labels){var j=this.graph_height+this.y_padding_top;for(h=0;h<this.y_label_count;h++){j=j-(this.graph_height/this.y_label_count);f+="M"+this.x_padding_left+","+j;f+="L"+(this.x_padding_left+this.graph_width)+","+j}}if(this.options.show_horizontal_labels){var e=this.x_padding_left+this.options.plot_padding+this.grid_start_offset,g=this.options.labels.length;for(h=0;h<g;h++){f+="M"+e+","+this.y_padding_top;f+="L"+e+","+(this.y_padding_top+this.graph_height);e=e+this.step}e=e-this.options.plot_padding-1;f+="M"+e+","+this.y_padding_top;f+="L"+e+","+(this.y_padding_top+this.graph_height)}this.paper.path(f).attr({stroke:this.options.grid_colour,"stroke-width":"1px"})},drawLines:function(g,l,k){var j=this.calculateCoords(k),f="";for(var h=0;h<j.length;h++){var e=j[h][0]||0,m=j[h][1]||0;f=this.drawPlot(h,f,e,m,l)}this.paper.path(f).attr({stroke:l,"stroke-width":"3px"})},calculateCoords:function(j){var f=this.x_padding_left+this.options.plot_padding-this.step,e=(this.graph_height+this.y_padding_top)+this.normalise(this.start_value),k=0,h=[];for(var g=0;g<j.length;g++){k=e-j[g];f=f+this.step;h.push([f,k])}return h},drawFocusHint:function(){var g=5,e=this.x_padding_left+(g/2)-1,h=this.options.height-this.y_padding_bottom,f="";f+="M"+e+","+h;f+="L"+(e-g)+","+(h-g);f+="M"+e+","+(h-g);f+="L"+(e-g)+","+(h-(g*2));this.paper.path(f).attr({stroke:this.options.label_colour,"stroke-width":2})},drawMeanLine:function(f){var g=f.sum()/f.length,e="";e+="M"+(this.x_padding_left-1)+","+(this.options.height-this.y_padding_bottom-g);e+="L"+(this.graph_width+this.x_padding_left)+","+(this.options.height-this.y_padding_bottom-g);this.paper.path(e).attr(this.options.meanline)},drawAxis:function(){var e="";e+="M"+(this.x_padding_left-1)+","+(this.options.height-this.y_padding_bottom);e+="L"+(this.graph_width+this.x_padding_left)+","+(this.options.height-this.y_padding_bottom);e+="M"+(this.x_padding_left-1)+","+(this.options.height-this.y_padding_bottom);e+="L"+(this.x_padding_left-1)+","+(this.y_padding_top);this.paper.path(e).attr({stroke:this.options.label_colour})},makeValueLabels:function(e){var h=this.label_step,f=this.start_value,j=[];for(var g=0;g<e;g++){f=this.roundValue((f+h),2);j.push(f)}return j},drawMarkers:function(l,r,f,m,o,h){function k(i){return i*r[0]}function e(i){return i*r[1]}var q=this.x_padding_left-1+k(m),p=this.options.height-this.y_padding_bottom+e(m),g="",n={font:this.options.font_size+'px "Arial"',stroke:"none",fill:"#000"};Object.extend(n,h||{});for(var j=0;j<l.length;j++){g+="M"+q+","+p;if(typeof l[j]!=="undefined"&&(l[j]+"").length>0){g+="L"+(q+e(5))+","+(p+k(5));this.paper.text(q+o[0],p-o[1],l[j]).attr(n).toFront()}q=q+k(f);p=p+e(f)}this.paper.path(g).attr({stroke:this.options.label_colour})},drawVerticalLabels:function(){var e=this.graph_height/this.y_label_count;this.drawMarkers(this.value_labels,[0,-1],e,e,[-8,-2],{"text-anchor":"end"})},drawHorizontalLabels:function(){this.drawMarkers(this.options.labels,[1,0],this.step,this.options.plot_padding,[0,(this.options.font_size+7)*-1])}});b.BarGraph=function(){this.initialize.apply(this,arguments)};Object.extend(b.BarGraph.prototype,b.BaseGraph.prototype);Object.extend(b.BarGraph.prototype,{chartDefaults:function(){return{plot_padding:0}},normaliserOptions:function(){return{start_value:0}},setChartSpecificOptions:function(){this.bar_padding=5;this.bar_width=this.calculateBarWidth();this.options.plot_padding=(this.bar_width/2);this.step=this.calculateStep();this.grid_start_offset=this.bar_padding-1;this.start_y=this.options.height-this.y_padding_bottom},calculateBarWidth:function(){return(this.graph_width/this.data_size)-this.bar_padding},calculateStep:function(){return(this.graph_width-(this.options.plot_padding*2)-(this.bar_padding*2))/c(this.data_size)},drawPlot:function(g,f,e,i,h){e=e+this.bar_padding;f+="M"+e+","+this.start_y;f+="L"+e+","+i;this.paper.path(f).attr({stroke:h,"stroke-width":this.bar_width+"px"});f="";e=e+this.step;f+="M"+e+","+this.start_y;return f},drawHorizontalLabels:function(){var e=this.bar_padding+this.options.plot_padding;this.drawMarkers(this.options.labels,[1,0],this.step,e,[0,(this.options.font_size+7)*-1])}});b.HorizontalBarGraph=function(){this.initialize.apply(this,arguments)};Object.extend(b.HorizontalBarGraph.prototype,b.BaseGraph.prototype);Object.extend(b.HorizontalBarGraph.prototype,{setChartSpecificOptions:function(){this.y_padding_top=0;this.x_padding_left=20+this.longestLabel()*(this.options.font_size/2);this.bar_padding=5;this.bar_width=this.calculateBarHeight();this.options.plot_padding=0;this.step=this.calculateStep()},normalise:function(e){var f=this.x_padding_left;return((e/this.range)*(this.graph_width-f))},calculateBarHeight:function(){return(this.graph_height/this.data_size)-this.bar_padding},calculateStep:function(){return(this.options.height-this.y_padding_bottom)/c(this.data_size)},drawLines:function(g,k,j){var e=this.x_padding_left+(this.options.plot_padding*2),l=this.options.height-this.y_padding_bottom-(this.step/2),f="M"+e+","+l,h;for(h=0;h<j.length;h++){f+="L"+(e+j[h]-this.normalise(this.start_value))+","+l;l=l-this.step;f+="M"+e+","+l}this.paper.path(f).attr({stroke:k,"stroke-width":this.bar_width+"px"})},drawFocusHint:function(){var g=5,e=this.x_padding_left+(this.step*2),h=this.options.height-this.y_padding_bottom,f="";f+="M"+e+","+h;f+="L"+(e-g)+","+(h+g);f+="M"+(e-g)+","+h;f+="L"+(e-(g*2))+","+(h+g);this.paper.path(f).attr({stroke:this.options.label_colour,"stroke-width":2})},drawVerticalLabels:function(){var e=(this.step/2)-(this.options.plot_padding*2);this.drawMarkers(this.options.labels,[0,-1],this.step,e,[-8,(this.options.font_size/8)],{"text-anchor":"end"})},drawHorizontalLabels:function(){var f=this.graph_width/this.y_label_count,e=this.makeValueLabels(this.y_label_count);this.drawMarkers(e,[1,0],f,f,[0,(this.options.font_size+7)*-1])}});b.LineGraph=function(){this.initialize.apply(this,arguments)};Object.extend(b.LineGraph.prototype,b.BaseGraph.prototype);Object.extend(b.LineGraph.prototype,{normalise:function(f){var e=this.start_value===0?this.top_value:this.top_value-this.start_value;return((f/e)*(this.graph_height))},chartDefaults:function(){return{plot_padding:10}},setChartSpecificOptions:function(){var e=this.longestLabel(this.value_labels);this.x_padding_left=30+e*(this.options.font_size/2);if(typeof this.options.curve_amount==="undefined"){this.options.curve_amount=10}},normaliserOptions:function(){return{start_value:this.options.start_value}},calculateStep:function(){return(this.graph_width-(this.options.plot_padding*2))/c(this.data_size)},startPlot:function(f,e,h,g){this.lastPoint={x:e,y:h};return f+"M"+e+","+h},drawPlot:function(h,g,e,k,j){var f=this.options.curve_amount;if(this.options.markers==="circle"){var i=this.paper.circle(e,k,this.options.marker_size);i.attr({"stroke-width":"1px",stroke:this.options.background_colour,fill:j})}if(h===0){return this.startPlot(g,e,k,j)}if(f){g+=["C",this.lastPoint.x+f,this.lastPoint.y,e-f,k,e,k]}else{g+="L"+e+","+k}this.lastPoint={x:e,y:k};return g}});b.SparkLine=function(){this.initialize.apply(this,arguments)};b.SparkLine.prototype={initialize:function(f,g,e){this.element=f;this.data=g;this.options={width:parseInt(a(f,"width"),10),height:parseInt(a(f,"height"),10),highlight:false,background_colour:a(f,"backgroundColor")||"#ffffff",colour:"#036"};Object.extend(this.options,e||{});this.step=this.calculateStep();this.paper=Raphael(this.element,this.options.width,this.options.height);if(this.options.acceptable_range){this.background=this.paper.rect(0,this.options.height-this.normalise(this.options.acceptable_range[1]),this.options.width,this.options.height-this.normalise(this.options.acceptable_range[0]))}else{this.background=this.paper.rect(0,0,this.options.width,this.options.height)}this.background.attr({fill:this.options.background_colour,stroke:"none"});this.draw()},calculateStep:function(){return this.options.width/c(this.data.length)},normalise:function(e){return(this.options.height/this.data.max())*e},draw:function(){var e=this.normaliseData(this.data);this.drawLines("",this.options.colour,e);if(this.options.highlight){this.showHighlight(e)}},drawLines:function(h,l,k){var g="",e=0,f=k.slice(1),j=0;g="M0,"+(this.options.height-k[0]);for(j=1;j<k.length;j++){e=e+this.step;g+="L"+e+","+b.round(this.options.height-k[j],2)}this.paper.path(g).attr({stroke:l});this.lastPoint={x:0,y:this.options.height-k[0]}},showHighlight:function(h){var g=2,e=this.options.width-g,f=this.options.highlight.index||h.length-1,k=h[f]+(Math.round(g/2));if(typeof(this.options.highlight.index)!=="undefined"){e=this.step*this.options.highlight.index}var j=this.paper.circle(e,this.options.height-k,g);j.attr({stroke:false,fill:this.options.highlight.colour})}};Object.extend(b.SparkLine.prototype,b.Base);b.SparkBar=function(){this.initialize.apply(this,arguments)};Object.extend(b.SparkBar.prototype,b.SparkLine.prototype);Object.extend(b.SparkBar.prototype,{calculateStep:function(){return this.options.width/c(this.data.length)},drawLines:function(g,l,k){var j=this.step>2?this.step-1:this.step,e=j,f="",h=0;for(h=0;h<k.length;h++){f+="M"+e+","+(this.options.height-k[h]);f+="L"+e+","+this.options.height;e=e+this.step}this.paper.path(f).attr({stroke:l,"stroke-width":j})}});d.Ico=b;if(typeof exports!=="undefined"){module.exports=b}})(typeof window==="undefined"?this:window);